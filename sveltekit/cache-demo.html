<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>304 Not Modified ã¨ãƒ‡ãƒ¼ã‚¿ä¿æŒã®å®Ÿé¨“</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .server { background-color: #e8f5e8; border-left: 4px solid #4caf50; }
        .client { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        .cache { background-color: #fff3e0; border-left: 4px solid #ff9800; }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005c99; }
        .highlight { background-color: #ffeb3b; padding: 2px 4px; }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 14px;
        }
        .sequence {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .step {
            display: flex;
            align-items: center;
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .step-number {
            background: #007acc;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        .arrow { margin: 0 10px; font-size: 18px; color: #666; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th { background-color: #f2f2f2; font-weight: bold; }
        .yes { color: #4caf50; font-weight: bold; }
        .no { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” 304 Not Modified ã¨ãƒ‡ãƒ¼ã‚¿ä¿æŒã®å®Ÿé¨“</h1>
        
        <div class="status server">
            <h3>ğŸŒ ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®çŠ¶æ…‹</h3>
            <p><strong>ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªMap:</strong> <span id="serverData">ç©º</span></p>
            <p><strong>ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•æ™‚é–“:</strong> <span id="serverUptime">ã‚µãƒ¼ãƒãƒ¼æœªèµ·å‹•</span></p>
        </div>

        <div class="status client">
            <h3>ğŸ–¥ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®çŠ¶æ…‹</h3>
            <p><strong>ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“:</strong> <span id="clientLoadTime">æœªèª­ã¿è¾¼ã¿</span></p>
            <p><strong>ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸:</strong> <span id="sessionData">ç©º</span></p>
        </div>

        <div class="status cache">
            <h3>ğŸ“¦ ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ³</h3>
            <p><strong>æœ€å¾Œã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:</strong> <span id="lastRequest">ãªã—</span></p>
            <p><strong>HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> <span id="httpStatus">-</span></p>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button onclick="addTodo()">ğŸ“ Todoè¿½åŠ ï¼ˆã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ï¼‰</button>
            <button onclick="simulateReload()">ğŸ”„ ãƒªãƒ­ãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
            <button onclick="clearServerData()">ğŸ—‘ï¸ ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“Š å®Ÿéš›ã®å‹•ä½œãƒ¡ã‚«ãƒ‹ã‚ºãƒ </h2>
        
        <table>
            <thead>
                <tr>
                    <th>é …ç›®</th>
                    <th>304ã®å¯¾è±¡</th>
                    <th>ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ä¿æŒ</th>
                    <th>ä¿å­˜å ´æ‰€</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>HTMLãƒ•ã‚¡ã‚¤ãƒ«</td>
                    <td class="yes">âœ… å¯¾è±¡</td>
                    <td class="yes">âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—</td>
                    <td>ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥</td>
                </tr>
                <tr>
                    <td>JSãƒãƒ³ãƒ‰ãƒ«</td>
                    <td class="yes">âœ… å¯¾è±¡</td>
                    <td class="yes">âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—</td>
                    <td>ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥</td>
                </tr>
                <tr>
                    <td><span class="highlight">ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿</span></td>
                    <td class="no">âŒ å¯¾è±¡å¤–</td>
                    <td class="yes">âœ… ä¿æŒã•ã‚Œã‚‹</td>
                    <td>ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãƒ¡ãƒ¢ãƒª</td>
                </tr>
                <tr>
                    <td>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®JavaScriptå¤‰æ•°</td>
                    <td class="no">âŒ å¯¾è±¡å¤–</td>
                    <td class="no">âŒ åˆæœŸåŒ–ã•ã‚Œã‚‹</td>
                    <td>ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ¢ãƒª</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="container">
        <h2>ğŸ”„ ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹</h2>
        
        <div class="sequence">
            <div class="step">
                <div class="step-number">1</div>
                <div>ãƒ–ãƒ©ã‚¦ã‚¶</div>
                <div class="arrow">â†’</div>
                <div>F5ã‚­ãƒ¼æŠ¼ä¸‹ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰</div>
            </div>
            
            <div class="step">
                <div class="step-number">2</div>
                <div>ãƒ–ãƒ©ã‚¦ã‚¶</div>
                <div class="arrow">â†’</div>
                <div>ã‚µãƒ¼ãƒãƒ¼: GET /todosï¼ˆHTMLãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰</div>
            </div>
            
            <div class="step">
                <div class="step-number">3</div>
                <div>ã‚µãƒ¼ãƒãƒ¼</div>
                <div class="arrow">â†’</div>
                <div>304 Not Modifiedï¼ˆ<span class="highlight">HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨</span>ï¼‰</div>
            </div>
            
            <div class="step">
                <div class="step-number">4</div>
                <div>ãƒ–ãƒ©ã‚¦ã‚¶</div>
                <div class="arrow">â†’</div>
                <div>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸHTMLã‚’è¡¨ç¤º</div>
            </div>
            
            <div class="step">
                <div class="step-number">5</div>
                <div>ãƒ–ãƒ©ã‚¦ã‚¶</div>
                <div class="arrow">â†’</div>
                <div>ã‚µãƒ¼ãƒãƒ¼: loadé–¢æ•°å®Ÿè¡Œè¦æ±‚</div>
            </div>
            
            <div class="step">
                <div class="step-number">6</div>
                <div>ã‚µãƒ¼ãƒãƒ¼</div>
                <div class="arrow">â†’</div>
                <div><span class="highlight">ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªMapã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—</span></div>
            </div>
            
            <div class="step">
                <div class="step-number">7</div>
                <div>ãƒ–ãƒ©ã‚¦ã‚¶</div>
                <div class="arrow">â†</div>
                <div>æœ€æ–°ã®Todoãƒ‡ãƒ¼ã‚¿ã§ç”»é¢æ›´æ–°</div>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ’¡ é‡è¦ãªç†è§£ãƒã‚¤ãƒ³ãƒˆ</h2>
        
        <div class="status server">
            <h4>âœ… ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®çœŸå®Ÿ</h4>
            <ul>
                <li><strong>ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªãƒ‡ãƒ¼ã‚¿ã¯ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹å†…ã§ç¶™ç¶šå­˜åœ¨</strong></li>
                <li>ãƒªãƒ­ãƒ¼ãƒ‰ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å‹•ä½œã§ã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯å½±éŸ¿ã—ãªã„</li>
                <li>loadé–¢æ•°ã¯æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹ãŒã€ã‚µãƒ¼ãƒãƒ¼ã®Mapã¯ä¿æŒã•ã‚Œã¦ã„ã‚‹</li>
            </ul>
        </div>

        <div class="status cache">
            <h4>ğŸ“¦ 304ã®å®Ÿéš›ã®å½¹å‰²</h4>
            <ul>
                <li><strong>é™çš„ãƒªã‚½ãƒ¼ã‚¹ï¼ˆHTMLã€JSã€CSSï¼‰ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡</strong></li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã¯ç„¡é–¢ä¿‚</li>
                <li>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è»¢é€é‡ã®å‰Šæ¸›ãŒç›®çš„</li>
            </ul>
        </div>

        <div class="status client">
            <h4>ğŸ”„ ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®çŠ¶æ…‹å¤‰åŒ–</h4>
            <ul>
                <li><strong>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®JavaScriptå¤‰æ•°ã¯åˆæœŸåŒ–</strong></li>
                <li>ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—</li>
                <li>çµæœçš„ã«ã€Œãƒ‡ãƒ¼ã‚¿ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ§ª SvelteKitã§ã®å®Ÿè£…ä¾‹</h2>
        
        <pre><code>// +page.server.ts
let todos = new Map(); // â† ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã«å­˜åœ¨

export const load = async () => {
  // ãƒªãƒ­ãƒ¼ãƒ‰ã®åº¦ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŒã€ã‚µãƒ¼ãƒãƒ¼ã®Mapã¯ä¿æŒ
  console.log('loadé–¢æ•°å®Ÿè¡Œ - ç¾åœ¨ã®Todoæ•°:', todos.size);
  return {
    todos: Array.from(todos.values())
  };
};

export const actions = {
  add: async ({ request }) => {
    const data = await request.formData();
    const todo = data.get('todo');
    // ã‚µãƒ¼ãƒãƒ¼ã®Mapã«ä¿å­˜ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ä¿æŒï¼‰
    todos.set(Date.now(), { text: todo, done: false });
  }
};</code></pre>
    </div>

    <script>
        // ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        let serverTodos = new Map();
        let serverStartTime = Date.now();
        let pageLoadTime = Date.now();
        let requestCount = 0;

        function updateDisplay() {
            document.getElementById('serverData').textContent = 
                serverTodos.size > 0 ? `${serverTodos.size}å€‹ã®Todo` : 'ç©º';
            
            document.getElementById('serverUptime').textContent = 
                Math.floor((Date.now() - serverStartTime) / 1000) + 'ç§’å‰';
            
            document.getElementById('clientLoadTime').textContent = 
                new Date(pageLoadTime).toLocaleTimeString();
            
            document.getElementById('sessionData').textContent = 
                sessionStorage.getItem('todos') || 'ç©º';
        }

        function addTodo() {
            requestCount++;
            const todoId = Date.now();
            const todoText = `Todo ${todoId}`;
            
            // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            serverTodos.set(todoId, { text: todoText, done: false });
            
            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±æ›´æ–°
            document.getElementById('lastRequest').textContent = 
                `POST /todos (Todoè¿½åŠ ) - ${new Date().toLocaleTimeString()}`;
            document.getElementById('httpStatus').textContent = '200 OK';
            
            updateDisplay();
            
            // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚‚ä¿å­˜ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®çŠ¶æ…‹ã¨ã—ã¦ï¼‰
            const todosArray = Array.from(serverTodos.values());
            sessionStorage.setItem('todos', JSON.stringify(todosArray));
        }

        function simulateReload() {
            // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            pageLoadTime = Date.now();
            
            // 304 ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            requestCount++;
            setTimeout(() => {
                document.getElementById('lastRequest').textContent = 
                    `GET /todos (ãƒªãƒ­ãƒ¼ãƒ‰) - ${new Date().toLocaleTimeString()}`;
                document.getElementById('httpStatus').textContent = '304 Not Modified';
                
                // loadé–¢æ•°ã®å®Ÿè¡Œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                console.log('loadé–¢æ•°å®Ÿè¡Œ - ã‚µãƒ¼ãƒãƒ¼ã®Todoæ•°:', serverTodos.size);
                
                updateDisplay();
                
                alert(`ğŸ”„ ãƒªãƒ­ãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†ï¼
                
ğŸ“¦ HTMLãƒ•ã‚¡ã‚¤ãƒ«: 304 Not Modified (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨)
ğŸŒ ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿: ${serverTodos.size}å€‹ã®Todoä¿æŒ
ğŸ–¥ï¸ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹: æ–°ã—ãåˆæœŸåŒ–
ğŸ“Š çµæœ: ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒç”»é¢ã«åæ˜ ã•ã‚Œã‚‹`);
            }, 500);
            
            // ä¸€æ™‚çš„ã«ãƒªãƒ­ãƒ¼ãƒ‰ä¸­è¡¨ç¤º
            document.getElementById('httpStatus').textContent = 'ãƒªãƒ­ãƒ¼ãƒ‰ä¸­...';
        }

        function clearServerData() {
            serverTodos.clear();
            sessionStorage.removeItem('todos');
            updateDisplay();
            
            document.getElementById('lastRequest').textContent = 
                `DELETE /todos (ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢) - ${new Date().toLocaleTimeString()}`;
            document.getElementById('httpStatus').textContent = '200 OK';
        }

        // åˆæœŸè¡¨ç¤º
        updateDisplay();
    </script>
</body>
</html>